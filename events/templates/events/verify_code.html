{% extends 'base.html' %}

{% load format_extras %}

{% block title %}Verify Code - {{ PLATFORM_NAME }}{% endblock %}

{% block content %}
<div class="container py-4" style="max-width: 500px">
  <div class="card">
    <div class="card-body p-4">
      <h1 class="h2 fw-bold mb-2">Verify Your Phone Number</h1>
      <p class="text-muted mb-4">
        Enter the verification code sent to {{ phone_number|format_phone }}.
      </p>

      <form method="post" action="{% url 'verify_code' %}">
        {% csrf_token %}
        <div class="mb-4">
          <label for="code" class="form-label fw-semibold"
            >Verification Code</label
          >
          <input
            type="text"
            name="code"
            id="code"
            placeholder="000000"
            maxlength="6"
            class="form-control form-control-lg text-center fs-3"
            style="letter-spacing: 0.5em"
            required
            autofocus
          />
          <p class="text-muted small mt-2 mb-0">
            Codes expire after 5 minutes.
          </p>
        </div>

        {% if is_new_user %}
        <div class="mb-4">
          <label for="name" class="form-label fw-semibold">Your Name</label>
          <input
            type="text"
            name="name"
            id="name"
            placeholder="John Doe"
            maxlength="100"
            class="form-control form-control-lg"
            required
          />
        </div>
        {% endif %}

        <button
          type="submit"
          class="btn btn-lg btn-primary w-100 py-2"
          title="Submit verification code"
        >
          Login
          <i class="fa fa-right-to-bracket ms-2" aria-hidden="true"></i>
        </button>
      </form>

      <form
        method="post"
        class="mt-3 text-center"
        hx-post="{% url 'resend_code' %}"
        hx-target="#flash-messages"
        hx-swap="outerHTML"
        hx-indicator="#resend-code-indicator"
      >
        {% csrf_token %}
        <button
          type="submit"
          class="btn btn-link text-decoration-none"
          title="Request a new verification code"
        >
          Resend code
          <span
            id="resend-code-indicator"
            class="ms-2 htmx-indicator spinner-border spinner-border-sm"
            role="status"
            aria-hidden="true"
          ></span>
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
