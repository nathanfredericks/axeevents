{% extends 'base.html' %}

{% block title %}Login - {{ PLATFORM_NAME }}{% endblock %}

{% block content %}
<div class="container py-4" style="max-width: 500px">
  <div class="card">
    <div class="card-body p-4">
      <h1 class="h2 fw-bold mb-2">Login</h1>
      <p class="text-muted mb-3">
        Enter your phone number to receive a verification code.
      </p>

      <form method="post" action="{% url 'phone_login' %}">
        {% csrf_token %}
        <div class="mb-4">
          <label for="phone_number" class="form-label fw-semibold"
            >Phone Number</label
          >
          <input
            type="tel"
            name="phone_number"
            id="phone_number"
            placeholder="+1 (555) 555-5555"
            class="form-control form-control-lg"
            required
          />
        </div>

        <button
          type="submit"
          class="btn btn-primary btn-lg w-100 py-2 d-flex justify-content-center align-items-center"
          title="Send verification code to this phone number"
        >
          <span>Send Verification Code</span>
          <i class="fa fa-envelope ms-2" aria-hidden="true"></i>
        </button>
      </form>
    </div>
  </div>
</div>

<script>
  function formatPhoneNumber(input) {
    let value = input.value.replace(/\D/g, "");

    if (value.length > 0 && value[0] !== "1") {
      value = "1" + value;
    }

    if (value.length >= 1) {
      if (value.length <= 1) {
        value = "+1";
      } else if (value.length <= 4) {
        value = "+1 (" + value.substring(1);
      } else if (value.length <= 7) {
        value = "+1 (" + value.substring(1, 4) + ") " + value.substring(4);
      } else {
        value =
          "+1 (" +
          value.substring(1, 4) +
          ") " +
          value.substring(4, 7) +
          "-" +
          value.substring(7, 11);
      }
    }

    input.value = value;
  }

  document
    .getElementById("phone_number")
    .addEventListener("input", function (e) {
      formatPhoneNumber(e.target);
    });

  document
    .getElementById("phone_number")
    .addEventListener("focus", function (e) {
      if (e.target.value === "") {
        e.target.value = "+1";
      }
    });
</script>
{% endblock %}
