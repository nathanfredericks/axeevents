{% with resolved_form_id=form_id|default:'rsvpForm' %} {% with
resolved_container_id=container_id|default:resolved_form_id %}
<section
  class="{{ wrapper_classes|default:'mb-4' }} rsvp-section"
  aria-labelledby="{{ resolved_form_id }}-heading"
  aria-live="polite"
>
  <h2 id="{{ resolved_form_id }}-heading" class="visually-hidden">
    RSVP actions
  </h2>
  {% if not is_creator %} {% if event.is_full and not user_rsvp %}
  <div class="alert alert-warning mb-3" role="status">
    This event is currently full
  </div>
  {% endif %} {% if user_rsvp %}
  <div class="alert alert-success mb-3" role="status">
    You're RSVPed as: <strong>{{ user_rsvp.get_status_display }}</strong>
  </div>
  {% endif %} {% if not event.allow_rsvp %}
  <div class="alert alert-info mb-3" role="status">
    RSVPs are currently closed for this event.
  </div>
  {% endif %} {% if event.allow_rsvp %}
  <form
    id="{{ resolved_form_id }}"
    method="post"
    action="{% url 'rsvp_event' event.id %}"
    class="d-flex flex-column flex-md-row gap-2 w-100 js-rsvp-form"
    aria-describedby="{{ resolved_form_id }}-helper"
    hx-post="{% url 'rsvp_event' event.id %}"
    hx-target="#{{ resolved_container_id }}"
    hx-swap="innerHTML"
  >
    {% csrf_token %}
    <input
      type="hidden"
      name="rsvp_container"
      value="{{ resolved_container_id }}"
    />
    {% if questionnaire %}
    <button
      type="button"
      class="btn btn-success btn-lg flex-fill d-flex align-items-center justify-content-center gap-2"
      {%
      if
      event.is_full
      and
      not
      user_is_attending
      %}disabled{%
      endif
      %}
      onclick="showQuestionnaireModal('{{ resolved_form_id }}', 'attending')"
      aria-haspopup="dialog"
      aria-controls="questionnaireModal"
    >
      <span>Going</span>
      <i class="fa-solid fa-circle-check" aria-hidden="true"></i>
    </button>
    {% else %}
    <button
      type="submit"
      name="status"
      value="attending"
      class="btn btn-success btn-lg flex-fill d-flex align-items-center justify-content-center gap-2"
      {%
      if
      event.is_full
      and
      not
      user_is_attending
      %}disabled{%
      endif
      %}
    >
      <span>Going</span>
      <i class="fa-solid fa-circle-check" aria-hidden="true"></i>
    </button>
    {% endif %} {% if event.allow_maybe_rsvp %}
    <button
      type="submit"
      name="status"
      value="maybe"
      class="btn btn-warning btn-lg flex-fill d-flex align-items-center justify-content-center gap-2"
    >
      <span>Maybe</span>
      <i class="fa-solid fa-circle-question" aria-hidden="true"></i>
    </button>
    {% endif %}
    <button
      type="submit"
      name="status"
      value="not_attending"
      class="btn btn-danger btn-lg flex-fill d-flex align-items-center justify-content-center gap-2"
    >
      <span>Can't Go</span>
      <i class="fa-solid fa-circle-xmark" aria-hidden="true"></i>
    </button>
  </form>
  <p id="{{ resolved_form_id }}-helper" class="visually-hidden">
    Use the buttons above to set your RSVP status.
  </p>
  {% elif user_rsvp and user_rsvp.status != 'not_attending' %}
  <form
    method="post"
    action="{% url 'rsvp_event' event.id %}"
    class="d-flex flex-column gap-3 w-100 js-rsvp-form"
    hx-post="{% url 'rsvp_event' event.id %}"
    hx-target="#{{ resolved_container_id }}"
    hx-swap="innerHTML"
  >
    {% csrf_token %}
    <input
      type="hidden"
      name="rsvp_container"
      value="{{ resolved_container_id }}"
    />
    <button
      type="submit"
      name="status"
      value="not_attending"
      class="btn btn-danger btn-lg w-100 d-flex align-items-center justify-content-center gap-2 py-3"
    >
      <i class="fa-solid fa-circle-xmark" aria-hidden="true"></i>
      <span>Cancel RSVP</span>
    </button>
  </form>
  {% endif %} {% endif %}
</section>
{% endwith %} {% endwith %}
